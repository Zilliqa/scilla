let list_append =
  tfun 'A =>
  fun (l1 : List 'A) =>
  fun (l2 : List 'A) =>
    (* Fold right over l1 and keep prepending elements to l2 *)
    (* l2 is the initial accumulator *)
    let folder = @list_foldr 'A (List 'A) in
    let init = l2 in
    let iter =
      fun (h : 'A) =>
      fun (z : List 'A) =>
        Cons {'A} h z
    in
      folder iter init l1
in

let list_flatten =
  tfun 'A =>
  fun (l : List List 'A) =>
    let folder = @list_foldr (List List 'A) (List 'A) in
    let init = Nil {'A} in
    let iter =
      fun (h : List 'A) =>
      fun (z : List 'A) =>
        let app = @list_append 'A in
        app h z
    in
      folder iter init l
in

let int_flatten = @list_flatten (List Int128) in

let one = Int128 1 in
let two = Int128 2 in
let three = Int128 3 in
let four = Int128 4 in

let nil = Nil {Int128} in
let l1 = Cons {Int128} four nil in
let l2 = Cons {Int128} three l1 in
let l3 = Cons {Int128} two l2 in
let l4 = Cons {Int128} one l3 in

let five = Int128 5 in
let six = Int128 6 in

let l5 = Cons {Int128} six nil in
let l6 = Cons {Int128} five l5 in


let ll1 = Cons {List Int128} l6 nil in
let ll2 = Cons {List Int128} l4 ll1 in

int_flatten ll2
