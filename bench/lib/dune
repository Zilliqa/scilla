(rule
  (targets spec_j.ml spec_j.mli)
  (deps    spec.atd)
  (mode    fallback)
  (action  (run atdgen -j %{deps})))

(rule
  (targets spec_t.ml spec_t.mli)
  (deps    spec.atd)
  (mode    fallback)
  (action  (run atdgen -t %{deps})))

(library
 (name scilla_bench)
 (library_flags -linkall)
 (modules spec transition spec_t spec_j env)
 (libraries
   core core_bench.inline_benchmarks yojson atdgen
   scilla_base scilla_eval scilla_util stateIPCTest)
 (preprocess (pps ppx_sexp_conv ppx_inline_test)))

(env (dev (flags (:standard -warn-error -A))))
