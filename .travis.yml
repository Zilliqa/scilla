language: generic
sudo: required
env:
  - OCAML_VERSION=4.06.1
  - OCAML_VERSION=4.07.1
os:
  - linux
  - osx
addons:
  apt:
    sources:
    - sourceline: 'ppa:tah83/secp256k1'
    packages:
    - ocaml
    - curl
    - build-essential
    - m4
    - pkg-config
    - zlib1g-dev
    - libgmp-dev
    - libssl-dev
    - libboost-system-dev
    - libpcre3-dev
    - aspcud
    - libsecp256k1-dev
  homebrew:
    brewfile: true
cache:
  directories:
  - $HOME/.opam
  - $HOME/openssl
branches:
  only: 
    - master
    - /^release-v.*$/
before_install:
- if [ $TRAVIS_OS_NAME = linux ]; then ./scripts/install_opam2_ubuntu.sh; fi
- opam init --disable-sandboxing --compiler=$OCAML_VERSION -y
- eval $(opam env)
- opam install ./scilla.opam --deps-only --with-test
- rm $HOME/.opam/log/*
script:
- make test
- make coveralls
